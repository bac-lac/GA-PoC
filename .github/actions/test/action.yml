name: Create tfvars file
decription: Create a tfvars file that's going to be used by terraform plan/apply.
inputs:
  ACCOUNT:
    required: true
  ADMIN_DB_PASSWORD:
    required: true
  ADMIN_DB_USERNAME:
    required: true
  DB_PASSWORD:
    required: true
  DB_USERNAME:
    required: true
  ECR_IMAGE:
    required: true
  ENV:
    required: true
  FORCE_REFRESH:
    required: true
  MFT_CLUSTER:
    required: true
  VARS:
    required: true
runs:
  using: "composite"
  steps:
    - name: echo variables
      id: echo2
      run: |
        echo "VARS: ${{ toJSON(inputs.VARS) }}"
      shell: bash
    - name: Setup Terraform variables
      working-directory: ./terraform
      id: vars
      run: |-
        cat > pipeline.auto.tfvars <<EOF
        ACCOUNT = "${{ inputs.ACCOUNT }}"
        ADMIN_DB_PASSWORD = "${{ inputs.ADMIN_DB_PASSWORD }}"
        ADMIN_DB_USERNAME = "${{ inputs.ADMIN_DB_USERNAME }}"
        BRANCH_NAME = "${{ env.BRANCH_NAME }}"
        DB_PASSWORD = "${{ inputs.DB_PASSWORD }}"
        DB_USERNAME = "${{ inputs.DB_USERNAME }}"
        ECR_IMAGE = "${{ inputs.ECR_IMAGE }}"
        ENV = "${{ inputs.ENV }}"
        FORCE_REFRESH = "${{ inputs.FORCE_REFRESH }}"
        MFT_CLUSTER = "${{ inputs.MFT_CLUSTER }}"
        EOF
      shell: bash